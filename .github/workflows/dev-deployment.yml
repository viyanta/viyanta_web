name: ğŸš€ Development Deployment (Viyanta)

on:
  push:
    branches:
      - main

env:
  ENVIRONMENT: dev
  PROJECT_NAME: viyanta

jobs:
  deploy:
    name: Deploy on Self-Hosted Runner
    runs-on: [self-hosted]

    steps:
      - name: ğŸ“¦ Checkout code
        uses: actions/checkout@v4

      # ğŸ”” Deployment Started Notification
      - name: ğŸ”” Notify Deployment Started
        run: |
          curl -X POST -H "Content-Type: application/json" \
          -d "{
            \"text\": \"ğŸš€ *Deployment Started*\n\nğŸ“Œ *Project Name:* ${PROJECT_NAME}\nğŸ‘¤ *Committed By:* ${GITHUB_ACTOR}\nğŸ’¬ *Commit Message:* ${{ github.event.head_commit.message }}\nğŸŒ± *ENV:* ${ENVIRONMENT}\"
          }" \
          "${{ secrets.GOOGLE_CHAT_WEBHOOK }}"

      # ğŸš€ Run deployment script locally
      - name: ğŸš€ Run deployment script
        run: |
          cd /home/ubuntu/deployment-script
          ./deploy.sh

      # âœ… Deployment Success Notification
      - name: âœ… Notify Deployment Success
        if: success()
        run: |
          curl -X POST -H "Content-Type: application/json" \
          -d "{
            \"text\": \"âœ… *Deployment Completed Successfully*\n\nğŸ“Œ *Project Name:* ${PROJECT_NAME}\nğŸŒ± *ENV:* ${ENVIRONMENT}\nğŸŒ *URL:* https://app.viyantainsights.com\"
          }" \
          "${{ secrets.GOOGLE_CHAT_WEBHOOK }}"

      # âŒ Deployment Failure Notification
      - name: âŒ Notify Deployment Failure
        if: failure()
        run: |
          curl -X POST -H "Content-Type: application/json" \
          -d "{
            \"text\": \"âŒ *Deployment Failed*\n\nğŸ“Œ *Project Name:* ${PROJECT_NAME}\nğŸ‘¤ *Committed By:* ${GITHUB_ACTOR}\nğŸ’¬ *Commit Message:* ${{ github.event.head_commit.message }}\nğŸŒ± *ENV:* ${ENVIRONMENT}\nğŸ” *Action:* Check GitHub Actions logs\"
          }" \
          "${{ secrets.GOOGLE_CHAT_WEBHOOK }}"
